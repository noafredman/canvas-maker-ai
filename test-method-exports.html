<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CanvasMaker Method Export Test</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
        }
        
        .test-results {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .method-test {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }
        
        .method-test.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .method-test.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .test-component {
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
            text-align: center;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="test-results">
        <h3>üîç CanvasMaker Method Export Test</h3>
        <div id="test-output">Testing...</div>
    </div>
    
    <div id="app">
        <!-- CanvasMaker will auto-initialize here -->
    </div>

    <script src="canvas.js"></script>
    <script>
        // Wait for CanvasMaker to auto-initialize
        setTimeout(() => {
            const canvas = window.canvasMaker;
            const testOutput = document.getElementById('test-output');
            
            if (!canvas) {
                testOutput.innerHTML = '<div class="method-test error">‚ùå CanvasMaker not found</div>';
                return;
            }
            
            let results = '<h4>Method Accessibility Tests:</h4>';
            
            // Test method existence
            const methods = [
                'addReactComponent',
                'removeReactComponent', 
                'positionReactComponent',
                'clearAllReactComponents'
            ];
            
            methods.forEach(methodName => {
                const exists = typeof canvas[methodName] === 'function';
                const status = exists ? 'success' : 'error';
                const icon = exists ? '‚úÖ' : '‚ùå';
                results += `<div class="method-test ${status}">${icon} canvas.${methodName}: ${exists ? 'EXISTS' : 'UNDEFINED'}</div>`;
            });
            
            // Test actual functionality
            results += '<h4>Functional Tests:</h4>';
            
            try {
                // Create a test component
                const testComponent = document.createElement('div');
                testComponent.className = 'test-component';
                testComponent.textContent = 'Test Component';
                
                // Test addReactComponent
                const shape = canvas.addReactComponent(testComponent, 50, 50, 150, 80);
                results += `<div class="method-test success">‚úÖ addReactComponent: Created shape with ID ${shape.id}</div>`;
                
                // Test removeReactComponent with ID
                const removed = canvas.removeReactComponent(shape.id);
                results += `<div class="method-test success">‚úÖ removeReactComponent(${shape.id}): ${removed ? 'SUCCESS' : 'FAILED'}</div>`;
                
                // Create components for clearAll test
                for (let i = 0; i < 3; i++) {
                    const comp = document.createElement('div');
                    comp.textContent = `Component ${i + 1}`;
                    comp.style.cssText = 'padding: 10px; background: #ff6b6b; color: white; border-radius: 4px;';
                    canvas.addReactComponent(comp, 100 + i * 50, 200, 80, 40);
                }
                
                // Test clearAllReactComponents with DOM element verification
                console.log('[TEST] Before clearAll - DOM elements:', document.querySelectorAll('[data-component-id]').length);
                const clearedCount = canvas.clearAllReactComponents();
                console.log('[TEST] After clearAll - DOM elements:', document.querySelectorAll('[data-component-id]').length);
                
                // Verify DOM elements were removed
                const remainingElements = document.querySelectorAll('[data-component-id]').length;
                const domClearedCorrectly = remainingElements === 0;
                
                results += `<div class="method-test success">‚úÖ clearAllReactComponents: Cleared ${clearedCount} components</div>`;
                results += `<div class="method-test ${domClearedCorrectly ? 'success' : 'error'}">${domClearedCorrectly ? '‚úÖ' : '‚ùå'} DOM cleanup: ${remainingElements} elements remaining</div>`;
                
            } catch (error) {
                results += `<div class="method-test error">‚ùå Functional test error: ${error.message}</div>`;
            }
            
            testOutput.innerHTML = results;
            
        }, 1000);
    </script>
</body>
</html>