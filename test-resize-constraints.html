<!DOCTYPE html>
<html lang="en" data-test-page>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CanvasMaker Resize Constraints Test</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .controls {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }
        
        .controls button {
            margin: 5px;
            padding: 8px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .controls button:hover {
            background: #0056b3;
        }
        
        .info {
            margin-top: 10px;
            padding: 10px;
            background: #e9ecef;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .canvas-wrapper {
            width: 100%;
            height: 600px;
            border: 1px solid #ccc;
            position: relative;
        }
        
        /* Test content styles */
        .test-content {
            padding: 10px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            font-weight: bold;
            border-radius: 4px;
        }
        
        .long-content {
            width: 300px;
            height: 200px;
            background: #ffd93d;
            padding: 15px;
            border-radius: 8px;
            color: #333;
        }
        
        .long-content h3 {
            margin: 0 0 10px 0;
        }
        
        .long-content p {
            margin: 5px 0;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>CanvasMaker Resize Constraints Test</h1>
        <p>This test demonstrates the new HTML component resize constraint feature that limits resizing to content size + 10px.</p>
        
        <div class="controls">
            <button onclick="addSmallComponent()">Add Small HTML Component</button>
            <button onclick="addLargeComponent()">Add Large HTML Component</button>
            <button onclick="addAutoSizeComponent()">Add Auto-Size Component (No Size Specified)</button>
            <button onclick="addNetflixComponent()">Add Netflix Navigation (Real HTML Test)</button>
            <button onclick="addOriginalHtmlComponent()">Add Original HTML (558√ó212)</button>
            <button onclick="addContentAnalysisTest()">Test Content Analysis (No Size Provided)</button>
            <button onclick="addNavigationTest()">Test Navigation Analysis (Should be ~60px tall)</button>
            <button onclick="addMobileComponent()">Add Mobile Component (Bug Test)</button>
            <button onclick="testManualConstraints()">Test Manual Constraint Override</button>
            <button onclick="testAbsoluteLimit()">Test Absolute Maximum Limit</button>
            <button onclick="configureSettings()">Configure Content Settings</button>
            <button onclick="disableCaps()">Disable Content Analysis Caps</button>
            <button onclick="testNavigationHeightFix()">Test Navigation Height Fix (v1.8.7)</button>
            <button onclick="checkConstraints()">Check Component Constraints</button>
            <button onclick="canvas.clear()">Clear Canvas</button>
            
            <div class="info">
                <strong>v1.8.7 Features:</strong><br>
                1. <strong>Standalone HTML Components</strong> - HTML components no longer piggyback on rectangle logic
                2. <strong>Navigation Height Fix</strong> - Navigation bars from outer apps no longer capped at 70px
                3. <strong>Flexible Constraints</strong> - HTML components use content-aware constraints without rigid defaults
                4. <strong>Cleaner Architecture</strong> - Dedicated rendering and hit detection for HTML components
                <br><br>
                <strong>Previous Features (v1.8.2-1.8.6):</strong><br>
                ‚Ä¢ Auto-size components with configurable caps and buffers
                ‚Ä¢ Structural HTML analysis with smart navigation detection
                ‚Ä¢ Content stability during resize operations
                ‚Ä¢ Smart conditional resizing based on content vs defaults
                <br><br>
                <strong>Instructions:</strong><br>
                ‚Ä¢ Click "Test Navigation Height Fix" to test the v1.8.7 improvement
                ‚Ä¢ Try "Add Auto-Size Component" to see automatic content sizing
                ‚Ä¢ Use "Configure Content Settings" to change buffer and limits
            </div>
        </div>
        
        <div class="canvas-wrapper" id="canvas-container"></div>
        
        <div class="controls">
            <h4>Test Results:</h4>
            <div id="test-results" style="font-family: monospace; font-size: 12px;"></div>
        </div>
    </div>

    <script src="canvas.js"></script>
    <script>
        // Initialize variables first
        let canvas;
        let componentCount = 0;
        let mobileComponent = null;
        
        // Initialize CanvasMaker after DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            const container = document.getElementById('canvas-container');
            if (!container) {
                logResult('‚ùå Canvas container not found!');
                return;
            }
            
            logResult('‚úÖ Container found, creating CanvasMaker...');
            
            try {
                canvas = new CanvasMaker(container, {
                    width: 1200,
                    height: 600,
                    toolbarPosition: 'top-left'
                });
                logResult('‚úÖ CanvasMaker created successfully!');
            } catch (error) {
                logResult(`‚ùå Error creating CanvasMaker: ${error.message}`);
                console.error('CanvasMaker creation error:', error);
                return;
            }
            
            // Switch to select tool by default
            canvas.currentTool = 'select';
            
            // Monitor resize events
            let lastLogTime = 0;
            canvas.on('beforeResize', (data) => {
                // Throttle logging to avoid spam during drag
                const now = Date.now();
                if (now - lastLogTime > 500) {
                    logResult(`Resizing component: ${data.element?.type || 'unknown'}`);
                    lastLogTime = now;
                }
            });
            
            // Initial instructions
            logResult('Canvas initialized. Add HTML components and test resize constraints.');
            logResult('Select a component and drag the resize handles to test the content size + 10px limit.');
        });
        
        function addSmallComponent() {
            if (!canvas) {
                logResult('‚ùå Canvas not initialized yet. Please wait...');
                return;
            }
            componentCount++;
            const content = `
                <div class="test-content">
                    Small Component ${componentCount}
                    <br>Content: 150x50px
                </div>
            `;
            
            const shape = canvas.addReactComponentWithHTML(
                content,
                100 + (componentCount * 20),
                100 + (componentCount * 20),
                180, // Initial size bigger than content
                80,
                { 
                    id: `small-component-${componentCount}`,
                    backgroundColor: 'transparent'
                }
            );
            
            logResult(`Added small component ${componentCount} with initial size 180x80, content ~150x50`);
        }
        
        function addLargeComponent() {
            componentCount++;
            const content = `
                <div class="long-content">
                    <h3>Large Component ${componentCount}</h3>
                    <p>This component has a lot of content that takes up space.</p>
                    <p>The actual content size is approximately 300x200px.</p>
                    <p>Try resizing this component - it should not resize beyond content size + 10px.</p>
                    <p>Current content dimensions: width=300px, height=200px</p>
                    <p>Maximum allowed resize: width=310px, height=210px</p>
                </div>
            `;
            
            const shape = canvas.addReactComponentWithHTML(
                content,
                300 + (componentCount * 30),
                150 + (componentCount * 30),
                400, // Initial size bigger than content
                300,
                { 
                    id: `large-component-${componentCount}`,
                    backgroundColor: 'transparent'
                }
            );
            
            logResult(`Added large component ${componentCount} with initial size 400x300, content ~300x200`);
        }
        
        function addAutoSizeComponent() {
            componentCount++;
            const content = `
                <div style="padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 12px;">
                    <h3 style="margin: 0 0 15px 0;">Auto-Size Component ${componentCount}</h3>
                    <p style="margin: 5px 0;">This component has NO width/height specified.</p>
                    <p style="margin: 5px 0;">Auto-sizes to content, max 375√ó650px</p>
                    <p style="margin: 5px 0;">Content size: ~320√ó120px</p>
                    <p style="margin: 5px 0;">Expected final: ~330√ó130px (content + buffer, under max)</p>
                </div>
            `;
            
            // Don't specify width/height - let it auto-size
            const shape = canvas.addReactComponentWithHTML(
                150 + (componentCount * 30),
                50 + (componentCount * 30),
                null, // No width specified
                null, // No height specified
                content,
                { 
                    id: `auto-size-${componentCount}`,
                    backgroundColor: 'transparent'
                }
            );
            
            logResult(`Added auto-size component ${componentCount} - no size specified, will auto-size to content`);
        }
        
        function addNetflixComponent() {
            componentCount++;
            logResult(`üîÑ Starting to create Netflix component ${componentCount}...`);
            
            // Your provided HTML content (with CSS isolation - no body styles)
            const content = `
                <style>
                    /* Scoped styles - no body selector to avoid affecting parent page */
                    .netflix-wrapper { 
                        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                        margin: 0; 
                        padding: 20px;
                        display: flex; 
                        align-items: center; 
                        justify-content: center;
                        background: #f8f9fa; 
                        min-height: 200px; /* Changed from 100vh */
                        width: 100%;
                        box-sizing: border-box;
                    }
                    .netflix-container {
                        background: white; 
                        padding: 20px; 
                        border-radius: 12px;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
                        text-align: center;
                        width: 100%; 
                        max-width: 500px;
                    }
                    .netflix-navigation {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding: 16px;
                        background-color: #000000;
                        border-radius: 8px;
                    }
                    .netflix-logo {
                        color: #E50914;
                        font-size: 24px;
                        font-weight: bold;
                    }
                    .netflix-nav-links {
                        list-style: none;
                        padding: 0;
                        margin: 0;
                        display: flex;
                        gap: 16px;
                    }
                    .netflix-nav-link {
                        text-decoration: none;
                        color: #FFFFFF;
                        font-size: 16px;
                    }
                    .netflix-nav-link:hover {
                        color: #B2B2B2;
                    }
                    @media (max-width: 768px) {
                        .netflix-nav-links {
                            flex-direction: column;
                            align-items: center;
                        }
                    }
                </style>
                
                <div class="netflix-wrapper">
                    <div class="netflix-container">
                        <nav class="netflix-navigation">
                            <a href="#" class="netflix-logo">Netflix</a>
                            <ul class="netflix-nav-links">
                                <li><a href="#" class="netflix-nav-link">Home</a></li>
                                <li><a href="#" class="netflix-nav-link">TV Shows</a></li>
                                <li><a href="#" class="netflix-nav-link">Movies</a></li>
                                <li><a href="#" class="netflix-nav-link">New & Popular</a></li>
                                <li><a href="#" class="netflix-nav-link">My List</a></li>
                            </ul>
                        </nav>
                    </div>
                </div>
            `;
            
            // Test auto-sizing with complex real-world HTML
            logResult(`üîÑ Calling addReactComponentWithHTML with null dimensions...`);
            
            let shape;
            try {
                shape = canvas.addReactComponentWithHTML(
                    50,
                    300,
                    null, // No width specified - should auto-size
                    null, // No height specified - should auto-size  
                    content,
                    { 
                        id: `netflix-component-${componentCount}`,
                        backgroundColor: 'transparent'
                    }
                );
                logResult(`‚úÖ Component created successfully`);
                logResult(`üìä Initial size: ${shape.width}√ó${shape.height}`);
                logResult(`üèÅ Has pending measurement: ${shape.pendingContentMeasurement}`);
            } catch (error) {
                logResult(`‚ùå Error creating component: ${error.message}`);
                return;
            }
            
            logResult(`Added Netflix navigation component ${componentCount} - complex HTML, auto-sizing`);
            logResult(`Expected: Component should auto-size to content, max 375√ó650px`);
            
            // Debug: Check the component after a short delay to see if auto-sizing worked
            setTimeout(() => {
                const debugShape = canvas.activeCanvasContext.shapes.find(s => s.id === `netflix-component-${componentCount}`);
                if (debugShape) {
                    logResult(`DEBUG: Component actual size: ${Math.round(debugShape.width)}√ó${Math.round(debugShape.height)}`);
                    logResult(`DEBUG: Has overflow info: ${!!debugShape.overflowInfo}`);
                    logResult(`DEBUG: Pending measurement: ${!!debugShape.pendingContentMeasurement}`);
                    if (debugShape.overflowInfo) {
                        const contentSize = `${debugShape.overflowInfo.scrollWidth}√ó${debugShape.overflowInfo.scrollHeight}`;
                        logResult(`DEBUG: Content size: ${contentSize}`);
                    }
                }
            }, 500);
        }
        
        function addOriginalHtmlComponent() {
            componentCount++;
            logResult(`üîÑ Creating component with your exact original HTML...`);
            
            // Your exact original HTML content (cleaned up but maintaining structure)
            const content = `
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <style>
                    body { 
                        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                        margin: 0; padding: 20px;
                        display: flex; align-items: center; justify-content: center;
                        background: #f8f9fa; min-height: 100vh;
                    }
                    .container {
                        background: white; padding: 20px; border-radius: 12px;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.1); text-align: center;
                        width: 100%; max-width: 500px;
                    }
                    .navigation {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding: 16px;
                        background-color: #000000;
                    }
                    .logo {
                        color: #E50914;
                        font-size: 24px;
                        font-weight: bold;
                    }
                    .nav-links {
                        list-style: none;
                        padding: 0;
                        margin: 0;
                        display: flex;
                        gap: 16px;
                    }
                    .nav-link {
                        text-decoration: none;
                        color: #FFFFFF;
                        font-size: 16px;
                    }
                    .nav-link:hover {
                        color: #B2B2B2;
                    }
                </style>
                
                <div class="container">
                    <nav class="navigation">
                        <a href="#" class="logo">Netflix</a>
                        <ul class="nav-links">
                            <li><a href="#" class="nav-link">Home</a></li>
                            <li><a href="#" class="nav-link">TV Shows</a></li>
                            <li><a href="#" class="nav-link">Movies</a></li>
                            <li><a href="#" class="nav-link">New & Popular</a></li>
                            <li><a href="#" class="nav-link">My List</a></li>
                        </ul>
                    </nav>
                </div>
            `;
            
            // Create with explicit size matching your original (558√ó212)
            const shape = canvas.addReactComponentWithHTML(
                100,
                500,
                558, // Explicit width from your original HTML
                212, // Explicit height from your original HTML  
                content,
                { 
                    id: `original-html-${componentCount}`,
                    backgroundColor: 'transparent'
                }
            );
            
            logResult(`‚úÖ Added original HTML component: requested 558√ó212px`);
            logResult(`üìè Initial actual size: ${Math.round(shape.width)}√ó${Math.round(shape.height)}px (should be capped at 375√ó212)`);
            logResult(`üì¶ Stored requested size: ${shape.requestedWidth}√ó${shape.requestedHeight}px`);
            logResult(`üß™ Try resizing - should be limited to max(558+10, content+10)`);
            
            // Debug after content loads
            setTimeout(() => {
                const debugShape = canvas.activeCanvasContext.shapes.find(s => s.id === `original-html-${componentCount}`);
                if (debugShape) {
                    logResult(`üîç After content measurement:`);
                    logResult(`   Current size: ${Math.round(debugShape.width)}√ó${Math.round(debugShape.height)}px`);
                    logResult(`   Requested size: ${debugShape.requestedWidth}√ó${debugShape.requestedHeight}px`);
                    
                    if (debugShape.overflowInfo) {
                        const contentSize = `${debugShape.overflowInfo.scrollWidth}√ó${debugShape.overflowInfo.scrollHeight}`;
                        const requestedMaxW = debugShape.requestedWidth + 10;
                        const requestedMaxH = debugShape.requestedHeight + 10;
                        const contentMaxW = debugShape.overflowInfo.scrollWidth + 10;
                        const contentMaxH = debugShape.overflowInfo.scrollHeight + 10;
                        const effectiveMaxW = Math.max(requestedMaxW, contentMaxW);
                        const effectiveMaxH = Math.max(requestedMaxH, contentMaxH);
                        
                        logResult(`   Content size: ${contentSize}px`);
                        logResult(`   Max resize should be: ${effectiveMaxW}√ó${effectiveMaxH}px`);
                        logResult(`   (= max(${requestedMaxW}, ${contentMaxW}) √ó max(${requestedMaxH}, ${contentMaxH}))`);
                    }
                }
            }, 500);
        }
        
        function addContentAnalysisTest() {
            componentCount++;
            logResult(`üîç Testing content analysis with explicit styling...`);
            
            // HTML content with explicit dimensions in styles
            const contentWithStyles = `
                <div style="width: 558px; height: 200px; background: linear-gradient(45deg, #ff6b6b, #4ecdc4); padding: 20px; border-radius: 8px; color: white;">
                    <h2 style="margin: 0 0 10px 0;">Content Analysis Test</h2>
                    <p style="margin: 5px 0;">This component has explicit styling: width: 558px, height: 200px</p>
                    <p style="margin: 5px 0;">The system should detect these dimensions automatically</p>
                    <p style="margin: 5px 0;">No width/height parameters provided to addReactComponentWithHTML()</p>
                </div>
            `;
            
            // Create component WITHOUT providing width/height - let content analysis handle it
            const shape = canvas.addReactComponentWithHTML(
                200,
                100,
                null, // No width - should detect from content
                null, // No height - should detect from content  
                contentWithStyles,
                { 
                    id: `content-analysis-${componentCount}`,
                    backgroundColor: 'transparent'
                }
            );
            
            logResult(`‚úÖ Created component using content analysis`);
            logResult(`üìê Expected: Content analysis should detect 558√ó200 from inline styles`);
            logResult(`üéØ Should be initially capped but resizable to detected size + buffer`);
            
            // Debug after creation
            setTimeout(() => {
                const debugShape = canvas.activeCanvasContext.shapes.find(s => s.id === `content-analysis-${componentCount}`);
                if (debugShape) {
                    logResult(`üîç Debug Results:`);
                    logResult(`   Initial size: ${Math.round(debugShape.width)}√ó${Math.round(debugShape.height)}`);
                    logResult(`   Stored requested: ${debugShape.requestedWidth}√ó${debugShape.requestedHeight}`);
                    if (debugShape.overflowInfo) {
                        const contentSize = `${debugShape.overflowInfo.scrollWidth}√ó${debugShape.overflowInfo.scrollHeight}`;
                        logResult(`   Measured content: ${contentSize}`);
                    }
                }
            }, 500);
        }
        
        function addNavigationTest() {
            componentCount++;
            logResult(`üß≠ Testing navigation content analysis...`);
            
            // Simple navigation HTML that should be detected as navigation
            const navHTML = `
                <nav style="background: #000; padding: 16px; border-radius: 8px;">
                    <a href="#" style="color: #E50914; font-weight: bold; font-size: 24px;">Netflix</a>
                    <ul style="list-style: none; display: flex; gap: 16px; margin: 0; padding: 0;">
                        <li><a href="#" style="color: white; text-decoration: none;">Home</a></li>
                        <li><a href="#" style="color: white; text-decoration: none;">TV Shows</a></li>
                        <li><a href="#" style="color: white; text-decoration: none;">Movies</a></li>
                        <li><a href="#" style="color: white; text-decoration: none;">New & Popular</a></li>
                        <li><a href="#" style="color: white; text-decoration: none;">My List</a></li>
                    </ul>
                </nav>
            `;
            
            // Create component WITHOUT providing width/height - let content analysis detect navigation
            const shape = canvas.addReactComponentWithHTML(
                50,
                50,
                null, // No width - should detect navigation content  
                null, // No height - should detect navigation content (should be ~60px)
                navHTML,
                { 
                    id: `navigation-test-${componentCount}`,
                    backgroundColor: 'transparent'
                }
            );
            
            logResult(`‚úÖ Created navigation component using content analysis`);
            logResult(`üéØ Expected: Should detect navigation and use short height (~60px instead of 200+)`);
            logResult(`üìê Initial size: ${Math.round(shape.width)}√ó${Math.round(shape.height)}`);
            
            // Debug after creation to check if navigation was detected
            setTimeout(() => {
                const debugShape = canvas.activeCanvasContext.shapes.find(s => s.id === `navigation-test-${componentCount}`);
                if (debugShape) {
                    logResult(`üîç Navigation Analysis Results:`);
                    logResult(`   Final size: ${Math.round(debugShape.width)}√ó${Math.round(debugShape.height)}`);
                    logResult(`   Stored requested: ${debugShape.requestedWidth}√ó${debugShape.requestedHeight}`);
                    logResult(`   Height should be ~60-70px for navigation content`);
                }
            }, 500);
        }
        
        function addMobileComponent() {
            componentCount++;
            const content = `
                <div style="width: 579px; height: 200px; background: #ff6b6b; padding: 15px; border-radius: 8px; color: white;">
                    <h3>Mobile Bug Test Component ${componentCount}</h3>
                    <p>This component has content width of 579px but is constrained to 375px container.</p>
                    <p>Content size: 579px √ó 200px</p>
                    <p>Initial container: 375px √ó 250px</p>
                    <p>After manual constraint: Should resize up to 589px √ó 667px</p>
                </div>
            `;
            
            const shape = canvas.addReactComponentWithHTML(
                content,
                50,
                400,
                375, // Mobile width constraint
                250,
                { 
                    id: `mobile-component-${componentCount}`,
                    backgroundColor: 'transparent'
                }
            );
            
            mobileComponent = shape;
            logResult(`Added mobile component ${componentCount} - content 579x200, container 375x250`);
        }
        
        function testManualConstraints() {
            if (!mobileComponent) {
                logResult('ERROR: Add Mobile Component first!');
                return;
            }
            
            // Set manual constraints larger than content size
            const success = canvas.setResizeConstraints(mobileComponent.id, {
                minWidth: 50,
                minHeight: 30,
                maxWidth: 589,  // Larger than content width (579px)
                maxHeight: 667  // Larger than content height (200px)
            });
            
            if (success) {
                logResult(`‚úÖ Manual constraints set: maxWidth=589px, maxHeight=667px`);
                logResult(`üß™ Now try manually resizing - should go up to 589px width, not stop at ~385px`);
            } else {
                logResult(`‚ùå Failed to set manual constraints`);
            }
        }
        
        function testAbsoluteLimit() {
            if (!mobileComponent) {
                logResult('ERROR: Add Mobile Component first!');
                return;
            }
            
            // Try to set constraints beyond absolute maximum (content √ó 3)
            const success = canvas.setResizeConstraints(mobileComponent.id, {
                maxWidth: 2000,  // Much larger than content √ó 3 (~579 √ó 3 = 1737px)
                maxHeight: 2000
            });
            
            if (success) {
                logResult(`‚úÖ Trying to set huge constraints: maxWidth=2000px, maxHeight=2000px`);
                logResult(`üß™ Try resizing - should be capped at content√ó3 ‚âà ${579*3}px √ó ${200*3}px`);
                logResult(`üìè Absolute limit prevents excessive resizing even with manual constraints`);
            }
        }
        
        function configureSettings() {
            // Show current settings
            const current = canvas.getContentResizeSettings();
            logResult(`Current settings: buffer=${current.buffer}px, maxMultiplier=${current.maxMultiplier}x, default=${current.defaultWidth}√ó${current.defaultHeight}px`);
            logResult(`Content analysis caps: ${current.contentAnalysisMaxWidth}√ó${current.contentAnalysisMaxHeight}px`);
            
            // Change settings including new content analysis caps
            const newSettings = canvas.setContentResizeSettings({
                buffer: 25,                    // Increase buffer to 25px
                maxMultiplier: 2.5,            // Reduce max multiplier to 2.5x
                defaultWidth: 400,             // Change defaults
                defaultHeight: 300,
                contentAnalysisMaxWidth: 800,  // Allow wider auto-detected content
                contentAnalysisMaxHeight: 500  // Allow taller auto-detected content
            });
            
            logResult(`‚úÖ Updated settings: buffer=${newSettings.buffer}px, maxMultiplier=${newSettings.maxMultiplier}x, default=${newSettings.defaultWidth}√ó${newSettings.defaultHeight}px`);
            logResult(`‚úÖ Content analysis caps: ${newSettings.contentAnalysisMaxWidth}√ó${newSettings.contentAnalysisMaxHeight}px`);
            logResult(`üß™ Add new components to see effect of new settings`);
        }
        
        function disableCaps() {
            // Disable content analysis caps entirely
            const newSettings = canvas.setContentResizeSettings({
                contentAnalysisMaxWidth: null,   // Disable width cap
                contentAnalysisMaxHeight: null   // Disable height cap
            });
            
            logResult(`‚úÖ Content analysis caps disabled!`);
            logResult(`‚úÖ Width cap: ${newSettings.contentAnalysisMaxWidth} (null = no limit)`);
            logResult(`‚úÖ Height cap: ${newSettings.contentAnalysisMaxHeight} (null = no limit)`);
            logResult(`üß™ Now content can be any size without caps - create components to test`);
        }
        
        function testNavigationHeightFix() {
            if (!canvas) {
                logResult('‚ùå Canvas not initialized yet. Please wait...');
                return;
            }
            componentCount++;
            logResult(`üß™ Testing Navigation Height Fix (v1.8.7)...`);
            
            // Create a navigation bar like one that would come from the outer app
            // This simulates the case where outer app creates navigation with specific dimensions
            const navHTML = `
                <style>
                    .nav-bar {
                        background: #1a1a1a;
                        padding: 12px 20px;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        border-radius: 8px;
                        width: 100%;
                        box-sizing: border-box;
                    }
                    .nav-logo {
                        color: #E50914;
                        font-size: 24px;
                        font-weight: bold;
                        text-decoration: none;
                    }
                    .nav-links {
                        display: flex;
                        gap: 24px;
                        list-style: none;
                        margin: 0;
                        padding: 0;
                    }
                    .nav-link {
                        color: white;
                        text-decoration: none;
                        font-size: 16px;
                        transition: color 0.3s;
                    }
                    .nav-link:hover {
                        color: #ccc;
                    }
                </style>
                <div class="nav-bar">
                    <a href="#" class="nav-logo">MyApp</a>
                    <ul class="nav-links">
                        <li><a href="#" class="nav-link">Dashboard</a></li>
                        <li><a href="#" class="nav-link">Projects</a></li>
                        <li><a href="#" class="nav-link">Settings</a></li>
                        <li><a href="#" class="nav-link">Profile</a></li>
                    </ul>
                </div>
            `;
            
            // Simulate outer app creating navigation with small initial height (like 70px)
            // This was the problematic case where navigation got locked at 70px
            const shape = canvas.addReactComponentWithHTML(
                50,
                50,
                500, // Width: 500px 
                70,  // Height: 70px (the problematic small height)
                navHTML,
                { 
                    id: `nav-height-fix-test-${componentCount}`,
                    backgroundColor: 'transparent'
                }
            );
            
            logResult(`‚úÖ Created navigation component with initial size 500√ó70px`);
            logResult(`üìè Component ID: ${shape.id}`);
            logResult(`üéØ Expected behavior:`);
            logResult(`   ‚Ä¢ Component should display at initial size (500√ó70px)`);
            logResult(`   ‚Ä¢ But should be RESIZABLE beyond 70px height`);
            logResult(`   ‚Ä¢ No more artificial height locking!`);
            logResult(`üß™ Try manually resizing this component vertically - it should work!`);
            
            // Test resize constraints after content loads
            setTimeout(() => {
                const debugShape = canvas.activeCanvasContext.shapes.find(s => s.id === `nav-height-fix-test-${componentCount}`);
                if (debugShape && debugShape.overflowInfo) {
                    const contentHeight = debugShape.overflowInfo.scrollHeight;
                    const initialHeight = debugShape.requestedHeight;
                    const minimumAllowedHeight = Math.max(contentHeight, initialHeight);
                    const buffer = canvas.options.contentResizeBuffer || 10;
                    const paddingBuffer = 20;
                    const expectedMaxHeight = minimumAllowedHeight + buffer + paddingBuffer;
                    
                    logResult(`üîç Constraint Analysis:`);
                    logResult(`   ‚Ä¢ Content height: ${contentHeight}px`);
                    logResult(`   ‚Ä¢ Initial height: ${initialHeight}px`);
                    logResult(`   ‚Ä¢ Minimum allowed: ${minimumAllowedHeight}px`);
                    logResult(`   ‚Ä¢ Expected max resize: ${Math.round(expectedMaxHeight)}px`);
                    logResult(`   ‚Ä¢ OLD v1.8.6 behavior: Would be locked at ${initialHeight}px ‚ùå`);
                    logResult(`   ‚Ä¢ NEW v1.8.7 behavior: Can resize to ${Math.round(expectedMaxHeight)}px ‚úÖ`);
                } else {
                    logResult(`‚è≥ Waiting for content measurement...`);
                }
            }, 500);
        }
        
        function checkConstraints() {
            const shapes = canvas.activeCanvasContext.shapes.filter(s => s.type === 'reactComponent');
            
            if (shapes.length === 0) {
                logResult('No HTML components found. Add some first!');
                return;
            }
            
            shapes.forEach((shape, index) => {
                const overflow = shape.overflowInfo;
                if (overflow) {
                    const maxWidth = overflow.scrollWidth + 10;
                    const maxHeight = overflow.scrollHeight + 10;
                    logResult(`Component ${shape.id || index}: Current size ${Math.round(shape.width)}x${Math.round(shape.height)}, Content size ${overflow.scrollWidth}x${overflow.scrollHeight}, Max allowed ${maxWidth}x${maxHeight}`);
                } else {
                    logResult(`Component ${shape.id || index}: No overflow info available yet (try double-clicking to activate)`);
                }
            });
        }
        
        function logResult(message) {
            const results = document.getElementById('test-results');
            const timestamp = new Date().toLocaleTimeString();
            results.innerHTML += `[${timestamp}] ${message}<br>`;
            results.scrollTop = results.scrollHeight;
        }
        
        // Ensure page scrolling is always enabled
        document.body.style.overflow = 'auto';
        document.documentElement.style.overflow = 'auto';
    </script>
</body>
</html>